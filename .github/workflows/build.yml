on:
  workflow_dispatch:
    inputs:
      PACKAGE_DIR:
        description: "set package dir to build and archive your package"
        required: true

jobs:
  build:
    name: üõ†Ô∏è build on ${{ matrix.platform }}

    # use the setup-miniconda helper, see
    # https://github.com/marketplace/actions/setup-miniconda for details
    strategy:
      fail-fast: true
      matrix:
        platform: [ubuntu-20.04, macos-11,]  #  windows-2022] windows is a bit sad :'(
    runs-on: ${{ matrix.platform }}
    steps:
      - uses: actions/checkout@v2

      - uses: conda-incubator/setup-miniconda@v2
        with:
          # miniconda-version: "4.11.0"
          mamba-version: "0.22.1"
          channels: conda-forge,defaults

      - name: Conda info
        run: conda info

      - name: Install mambabuild
        run: |
          mamba install --channel conda-forge boa==0.11.0

      - name: Build package
        run: |
          # store the output in an out of tree location
          mkdir -p ${{ github.event.inputs.PACKAGE_DIR }}.output
          conda mambabuild -c conda-forge --output-folder ${{ github.event.inputs.PACKAGE_DIR }}.output ${{ github.event.inputs.PACKAGE_DIR }}

      # upload-artifact to save the output files
      - uses: actions/upload-artifact@v2
        with:
          name: packages
          path: ${{ github.event.inputs.PACKAGE_DIR }}.output
